<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        svg {
            width: 100vw;
            height: 100vh;
        }
        .tooltip {
            position: absolute;
            text-align: center;
            padding: 5px;
            font: 12px sans-serif;
            background: lightsteelblue;
            border: 0;
            border-radius: 8px;
            pointer-events: none;
            opacity: 0;
        }
    </style>
</head>
<body>
<script>
    // Set up dimensions
    var width = window.innerWidth;
    var height = window.innerHeight;

    // Create the SVG element
    var svg = d3.select("body").append("svg")
        .attr("width", width)
        .attr("height", height);

    // Set up the projection and path generator
    var projection = d3.geo.mercator()
        .scale(width / 2 / Math.PI)
        .translate([width / 2, height / 2]);

    var path = d3.geo.path()
        .projection(projection);

    // Load the GeoJSON data
    var geojsonUrl = 'https://skillet64.github.io/498/world.geojson';

    d3.json(geojsonUrl, function(error, geojson) {
        if (error) throw error;

        // Draw the country borders
        svg.selectAll("path")
            .data(geojson.features)
            .enter().append("path")
            .attr("d", path)
            .attr("fill", "none")
            .attr("stroke", "#000")
            .attr("stroke-width", 1);
    });

    // Load the CSV data
    var csvUrl = 'https://skillet64.github.io/498/ml-Meteorite_Landings.csv'; // Replace with the URL to your CSV file

    // Create a tooltip div
    var tooltip = d3.select("body").append("div")
        .attr("class", "tooltip");

    d3.csv(csvUrl, function(error, data) {
        if (error) throw error;

        // Log the raw CSV data and a sample
        console.log("Raw CSV data:", data);
        console.log("First data item:", data[0]);

        // Check if fields are properly parsed
        if (data.length > 0) {
            console.log("Field names in first row:", Object.keys(data[0]));
        }

        // Process and add pins
        svg.selectAll("circle")
            .data(data)
            .enter().append("circle")
            .attr("cx", function(d) {
                // Ensure correct coordinate order: [longitude, latitude]
                var coords = projection([+d.reclong, +d.reclat]);
                return coords[0];
            })
            .attr("cy", function(d) {
                var coords = projection([+d.reclong, +d.reclat]);
                return coords[1];
            })
            .attr("r", 3)
            .attr("fill", "red")
            .attr("stroke", "black")
            .attr("stroke-width", 1)
            .on("mouseover", function(event, d) {
                console.log("Mouseover data:", d);
                console.log("Available fields:", Object.keys(d));
                tooltip.transition()
                    .duration(200)
                    .style("opacity", .9);
                tooltip.html(d.name || "No name") // Adjust to the correct field if needed
                    .style("left", (event.pageX + 5) + "px")
                    .style("top", (event.pageY - 28) + "px");
            })
            .on("mouseout", function(d) {
                tooltip.transition()
                    .duration(500)
                    .style("opacity", 0);
            });
    });

    // Handle window resizing
    window.onresize = function() {
        width = window.innerWidth;
        height = window.innerHeight;
        svg.attr("width", width)
           .attr("height", height);

        projection
            .scale(width / 2 / Math.PI)
            .translate([width / 2, height / 2]);

        svg.selectAll("path")
            .attr("d", path);

        svg.selectAll("circle")
            .attr("cx", function(d) {
                var coords = projection([+d.reclong, +d.reclat]);
                return coords[0];
            })
            .attr("cy", function(d) {
                var coords = projection([+d.reclong, +d.reclat]);
                return coords[1];
            });
    };
</script>
</body>
</html>
