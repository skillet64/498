const width = 600;
const height = 400;
const data = [
  { name: "A", value: 20 },
  { name: "B", value: 30 },
  { name: "C", value: 50 }
];

const radius = Math.min(width, height) / 2;
const innerRadius = radius * 0.67;

const arc = d3.arc()
  .innerRadius(innerRadius)
  .outerRadius(radius - 1);

const pie = d3.pie()
  .padAngle(1 / radius)
  .sort(null)
  .value(d => d.value);

const color = d3.scaleOrdinal()
  .domain(data.map(d => d.name))
  .range(d3.quantize(t => d3.interpolateSpectral(t * 0.8 + 0.1), data.length).reverse());

const svg = d3.select("body").append("svg")
  .attr("width", width)
  .attr("height", height)
  .attr("viewBox", [-width / 2, -height / 2, width, height])
  .attr("style", "max-width: 100%; height: auto;")
  .append("g")
  .attr("transform", `translate(${width / 2},${height / 2})`);

// Draw pie slices
svg.selectAll("path")
  .data(pie(data))
  .enter().append("path")
  .attr("fill", d => color(d.data.name))
  .attr("d", arc)
  .append("title")
  .text(d => `${d.data.name}: ${d.data.value.toLocaleString()}`);

// Draw text labels outside the pie chart
const labels = svg.selectAll("text")
  .data(pie(data))
  .enter().append("text")
  .attr("dy", "0.35em")
  .attr("transform", d => {
    const pos = arc.centroid(d);
    const posNorm = normalize(pos);
    const posOut = vecScale(vecAdd(posNorm, radius * 0.5), 1.1); // Adjust positioning here
    return `translate(${posOut})`;
  })
  .attr("text-anchor", d => {
    // Determine text-anchor based on the centroid position
    return (arc.centroid(d)[0] > 0) ? "start" : "end";
  })
  .text(d => `${d.data.name}: ${d.data.value.toLocaleString()}`);

// Helper functions for vector operations
function normalize(v) {
  const mag = Math.sqrt(v[0] * v[0] + v[1] * v[1]);
  return [v[0] / mag, v[1] / mag];
}

function vecAdd(v1, v2) {
  return [v1[0] + v2, v1[1] + v2];
}

function vecScale(v, scalar) {
  return [v[0] * scalar, v[1] * scalar];
}
