<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meteorite Data Visualizations</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #5D6D7E; /* Background color */
            color: #fff; /* White text color */
        }
        .container {
            display: flex;
            align-items: flex-start;
            padding: 20px;
            box-sizing: border-box;
        }
        .text-content {
            width: 300px;
            margin-right: 20px;
        }
        .tooltip {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.7);
            color: #fff;
            padding: 5px;
            border-radius: 3px;
            pointer-events: none;
            display: none;
        }
        svg {
            border: 1px solid #444; /* Dark border */
        }
        .bar-found {
            fill: #fff; /* Teal color for Found bars */
        }
        .bar-fell {
            fill: #fff; /* White color for Fell bars */
        }
        .scatter {
            fill: #ff4d4d; /* Red color for scatter points */
        }
        .label {
            font-size: 12px;
            fill: #fff; /* White color for labels */
        }
        .axis-label {
            font-size: 14px;
            font-weight: bold;
            fill: #fff; /* White color for axis labels */
        }
        .chart-svg {
            margin-bottom: 20px;
        }
        #stacked-chart-container {
            overflow-x: auto; /* Enable horizontal scrolling */
            white-space: nowrap; /* Ensure the SVG does not wrap */
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="text-content">
            <h2>The Heaviest Meteorites Ever Recorded</h2>
            <p>According to National Geographic, the largest meteorite ever discovered on Earth is the Hoba meteorite, found in Namibia in 1920. 
                Weighing approximately 54,000 kilograms (119,000 pounds), the Hoba meteorite is so massive that it remains in its original location. 
                Its enormous size and weight make it impossible to move, and it has been preserved exactly where it was discovered. 
                This remarkable meteorite offers a unique opportunity to study an extraterrestrial object in its natural setting.
            </p>
        </div>
        <div id="horizontal-chart-container">
            <!-- Horizontal bar chart will be appended here -->
        </div>
    </div>
    <div class="container">
        <div class="text-content">
            <h2>Meteorite Discoveries Over Time</h2>
            <p>
                There are several factors contributing to the increase in meteorite finds over recent years. 
                Primarily, climate change and advancements in transportation technology have played significant roles. 
                The melting of Arctic ice has uncovered numerous meteorite specimens that were previously inaccessible. 
                Additionally, our rapid technological progress has enabled us to retrieve meteorites from the Moon's craters. 
                This combination of environmental and technological changes has greatly enhanced our ability to discover and study meteorites. 
            </p>
        </div>
        <div id="stacked-chart-container">
            <!-- Stacked bar chart will be appended here -->
        </div>
    </div>
    <div class="tooltip"></div>
    <script>
        // Define dimensions and margins
        const margin = { top: 20, right: 20, bottom: 100, left: 150 },
              width = 1500 - margin.left - margin.right, // Increased width for scrolling
              height = 600 - margin.top - margin.bottom;

        // Create SVG containers
        const horizontalContainer = d3.select("#horizontal-chart-container");
        const stackedContainer = d3.select("#stacked-chart-container");

        // Create a tooltip
        const tooltip = d3.select(".tooltip");

        // Load and process data
        Promise.all([
            d3.csv('https://skillet64.github.io/498/biggest.csv'),
            d3.csv('https://skillet64.github.io/498/ml-Meteorite_Landings Pivot-ml-Meteorite_Landings Pivot.csv')
        ]).then(([biggestData, pivotData]) => {
            
            // Log the raw data for debugging
            console.log("Biggest Data:", biggestData);
            console.log("Pivot Data:", pivotData);

            // Process the data for the horizontal bar chart
            biggestData.forEach(d => {
                d.mass = +d['mass (g) (Sum)'];
            });
            biggestData.sort((a, b) => b.mass - a.mass);

            const x1 = d3.scaleLinear()
                .domain([0, d3.max(biggestData, d => d.mass)])
                .range([0, width]);

            const y1 = d3.scaleBand()
                .domain(biggestData.map(d => d.name))
                .range([0, height])
                .padding(0.1);

            const horizontalSvg = horizontalContainer.append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .attr("class", "chart-svg");

            horizontalSvg.append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`)
                .selectAll(".bar")
                .data(biggestData)
                .enter().append("rect")
                .attr("class", "bar")
                .attr("x", 0)
                .attr("y", d => y1(d.name))
                .attr("width", d => x1(d.mass))
                .attr("height", y1.bandwidth())
                .style("fill", "#fff") // Set color to white for horizontal bars
                .on("mouseover", function(event, d) {
                    tooltip
                        .style("display", "block")
                        .html(`Name: ${d.name}<br>Mass: ${d.mass} g`);
                })
                .on("mousemove", function(event) {
                    tooltip
                        .style("top", (event.pageY + 5) + "px")
                        .style("left", (event.pageX + 5) + "px");
                })
                .on("mouseout", function() {
                    tooltip.style("display", "none");
                });

            // Add Y axis to the horizontal bar chart
            horizontalSvg.append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`)
                .call(d3.axisLeft(y1).tickSize(0))
                .append("text")
                .attr("class", "axis-label")
                .attr("x", -margin.left)
                .attr("y", -10)
                .attr("fill", "#fff") // Set color to white for axis label
                .attr("text-anchor", "start")
                .text("Meteorite Name");

            // Add grid lines to the horizontal bar chart
            horizontalSvg.append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`)
                .attr("class", "grid")
                .call(d3.axisBottom(x1)
                    .ticks(10)
                    .tickSize(-height)
                    .tickFormat('')
                );

            // Process the data for the stacked bar chart
            pivotData.forEach(d => {
                d.Fell = +d.Fell || 0; // Number of meteorites that fell each year
                d.Found = +d.Found || 0; // Number of meteorites found each year
                d.year = d.fall; // Use fall as the year
                if (d.year < 1399) {
                d.year = 1399;
            }
                d['Grand Total'] = d.Fell + d.Found; // Total number of meteorites for each year
            });

            // Filter out data where year is "Unknown" or Grand Total is 0
            pivotData = pivotData.filter(d => d.year !== "Unknown" && d['Grand Total'] > 0);

            // Bin years into 10-year intervals
            const binWidth = 100;
            const binnedData = d3.rollup(
                pivotData,
                v => ({
                    Fell: d3.sum(v, d => d.Fell),
                    Found: d3.sum(v, d => d.Found),
                    GrandTotal: d3.sum(v, d => d['Grand Total'])
                }),
                d => Math.floor(d.year / binWidth) * binWidth
            );

            // Convert the binned data into an array
            const binnedArray = Array.from(binnedData, ([year, values]) => ({
                year: `${year}-${year + binWidth - 1}`,
                ...values
            }));

            // Log binned data for debugging
            console.log("Binned Data:", binnedArray);

            const x2 = d3.scaleBand()
                .domain(binnedArray.map(d => d.year))
                .range([0, width])
                .padding(0.1);

            const y2 = d3.scaleLog()
                .domain([1, d3.max(binnedArray, d => d['GrandTotal'])])
                .nice()
                .range([height, 0]);

            const color = d3.scaleOrdinal()
                .domain(['Fell', 'Found'])
                .range(['#ff4d4d', '#00bfae']); // Red and Teal colors

            const stackedSvg = stackedContainer.append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .attr("class", "chart-svg");

            const stackedData = d3.stack()
                .keys(['Fell', 'Found'])
                (binnedArray);

            // Log stacked data for debugging
            console.log("Stacked Data:", stackedData);

            stackedSvg.append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`)
                .selectAll(".layer")
                .data(stackedData)
                .enter().append("g")
                .attr("class", "layer")
                .attr("fill", d => color(d.key))
                .selectAll("rect")
                .data(d => d)
                .enter().append("rect")
                .attr("x", d => x2(d.data.year))
                .attr("y", d => y2(d[1]))
                .attr("height", d => y2(d[0]) - y2(d[1]))
                .attr("width", x2.bandwidth())
                .on("mouseover", function(event, d) {
                    tooltip
                        .style("display", "block")
                        .html(`Year: ${d.data.year}<br>${d.key}: ${d[1] - d[0]}`);
                })
                .on("mousemove", function(event) {
                    tooltip
                        .style("top", (event.pageY + 5) + "px")
                        .style("left", (event.pageX + 5) + "px");
                })
                .on("mouseout", function() {
                    tooltip.style("display", "none");
                });

            // Add X and Y axes to the stacked bar chart
            stackedSvg.append("g")
                .attr("transform", `translate(${margin.left},${height + margin.top})`)
                .call(d3.axisBottom(x2).tickSize(0))
                .append("text")
                .attr("class", "axis-label")
                .attr("x", width)
                .attr("y", margin.bottom - 10)
                .attr("fill", "#fff") // Set color to white for axis label
                .attr("text-anchor", "end")
                .text("Year");

            stackedSvg.append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`)
                .call(d3.axisLeft(y2).ticks(10, ".0s"))
                .append("text")
                .attr("class", "axis-label")
                .attr("x", -margin.left)
                .attr("y", -10)
                .attr("fill", "#fff") // Set color to white for axis label
                .attr("text-anchor", "start")
                .text("Number of Meteorites");
        });
    </script>
</body>
</html>
