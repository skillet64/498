<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meteorite Discoveries</title>
    <style>
        /* CSS Styles */
        body {
            font-family: Arial, sans-serif;
            background-color: #1a1a1a; /* Dark background for better contrast */
            color: #f0f0f0; /* Light text color */
            margin: 0;
            padding: 20px;
        }

        h2 {
            color: #fff; /* White color for headings */
        }

        p {
            color: #ccc; /* Light gray color for text */
            font-size: 14px;
        }

        .container {
            margin: 20px 0;
        }

        #scroll-container {
            overflow-x: auto;
            white-space: nowrap;
            margin: 20px 0;
        }

        #stacked-chart-svg {
            display: inline-block;
        }

        .axis-label {
            font-size: 14px;
            font-weight: bold;
            fill: #fff; /* White color for axis labels */
        }

        .axis-text {
            font-size: 12px;
            fill: #fff; /* White color for axis labels */
        }

        .grid line {
            stroke: #555; /* Nebula Gray */
            stroke-width: 1px;
        }

        .tooltip {
            position: absolute;
            text-align: center;
            padding: 5px;
            background: #333;
            color: #fff;
            border-radius: 4px;
            pointer-events: none;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="text-content">
            <h2>Meteorite Discoveries Over Time</h2>
            <p>
                There are several factors contributing to the increase in meteorite finds over recent years. 
                Primarily, climate change and advancements in transportation technology have played significant roles. 
                The melting of Arctic ice has uncovered numerous meteorite specimens that were previously inaccessible. 
                Additionally, our rapid technological progress has enabled us to retrieve meteorites from the Moon's craters. 
                This combination of environmental and technological changes has greatly enhanced our ability to discover and study meteorites. 
            </p>
        </div>
        <div id="scroll-container">
            <svg id="stacked-chart-svg" width="1500" height="600">
                <!-- Stacked bar chart will be appended here -->
            </svg>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
        // JavaScript with D3.js
        const margin = { top: 20, right: 20, bottom: 100, left: 150 },
              width = 1500 - margin.left - margin.right,
              height = 600 - margin.top - margin.bottom;

        const stackedSvg = d3.select("#stacked-chart-svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom);

        Promise.all([
            d3.csv('https://skillet64.github.io/498/ml-Meteorite_Landings Pivot-ml-Meteorite_Landings Pivot.csv')
        ]).then(([pivotData]) => {
            
            pivotData.forEach(d => {
                d.Fell = +d.Fell;
                d.Found = +d.Found;
            });
            pivotData = pivotData.filter(d => d.fall !== "Unknown");

            const x2 = d3.scaleBand()
                .domain(pivotData.map(d => d.fall))
                .range([0, width])
                .padding(0.1);

            const y2 = d3.scaleLinear()
                .domain([0, d3.max(pivotData, d => d.Fell + d.Found)])
                .range([height, 0]);

            const color = d3.scaleOrdinal()
                .domain(['Fell', 'Found'])
                .range(['#ff4d4d', '#00bfae']); // Red and Teal colors

            const stackedData = d3.stack()
                .keys(['Fell', 'Found'])
                (pivotData);

            // Append bars
            stackedSvg.append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`)
                .selectAll(".layer")
                .data(stackedData)
                .enter().append("g")
                .attr("class", "layer")
                .attr("fill", d => color(d.key))
                .selectAll("rect")
                .data(d => d)
                .enter().append("rect")
                .attr("x", d => x2(d.data.fall))
                .attr("y", d => y2(d[1]))
                .attr("height", d => y2(d[0]) - y2(d[1]))
                .attr("width", x2.bandwidth())
                .on("mouseover", function(event, d) {
                    d3.select("#tooltip")
                        .style("display", "block")
                        .html(`Year: ${d.data.fall}<br>${d.key}: ${d[1] - d[0]}`);
                })
                .on("mousemove", function(event) {
                    d3.select("#tooltip")
                        .style("top", (event.pageY + 5) + "px")
                        .style("left", (event.pageX + 5) + "px");
                })
                .on("mouseout", function() {
                    d3.select("#tooltip").style("display", "none");
                });

            // Append x-axis
            stackedSvg.append("g")
                .attr("transform", `translate(${margin.left},${height + margin.top})`)
                .call(d3.axisBottom(x2)
                    .tickSize(0))
                .selectAll("text")
                .attr("class", "axis-text")
                .attr("transform", "rotate(-45)")
                .attr("text-anchor", "end");

            // Append y-axis
            stackedSvg.append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`)
                .call(d3.axisLeft(y2).ticks(10))
                .append("text")
                .attr("class", "axis-label")
                .attr("x", -margin.left)
                .attr("y", -10)
                .attr("fill", "#fff")
                .attr("text-anchor", "start")
                .text("Number of Meteorites");

            // Append grid lines
            stackedSvg.append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`)
                .attr("class", "grid")
                .call(d3.axisLeft(y2)
                    .ticks(10)
                    .tickSize(-width)
                    .tickFormat('')
                );
        });
    </script>
</body>
</html>
