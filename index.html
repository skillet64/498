<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meteorite Data Visualizations</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/versor@0.2/dist/versor.min.js"></script>
    <script src="https://d3js.org/topojson.v3.min.js"></script>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #2C3E50;
            color: #fff;
        }
        h1 {
            text-align: center;
            font-weight: bold;
            color: #fff;
            margin: 20px;
        }
        .container {
            display: flex;
            align-items: flex-start;
            padding: 20px;
            box-sizing: border-box;
        }
        .text-content {
            width: 300px;
            margin-right: 20px;
        }
        .tooltip {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.7);
            color: #fff;
            padding: 5px;
            border-radius: 3px;
            pointer-events: none;
            display: none;
        }
        svg {
            border: 1px solid #444;
        }
        .bar {
            fill: #F1C40F; /* Yellow for bars */
        }
        .bar-hover {
            fill: #fff; /* White for hover effect */
        }
        .stacked-bar {
            fill: #BDC3C7; /* Default fill color for stacked bars */
        }
        .label {
            font-size: 12px;
            fill: #fff;
        }
        .axis-label {
            font-size: 14px;
            font-weight: bold;
            fill: #fff;
        }
        .chart-svg {
            margin-bottom: 20px;
        }
        #stacked-chart-container {
            overflow-x: auto;
            white-space: nowrap;
        }
        .legend {
            font-size: 14px;
            fill: #fff;
        }
        .legend rect {
            stroke-width: 2px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 10px;
        }
        #globe-container {
            position: relative;
            width: 100%;
            height: 600px;
        }
        canvas {
            display: block;
            margin: 0 auto;
        }
        .controls {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 10;
            background: white;
            padding: 10px;
            border-radius: 5px;
        }
        .controls button {
            margin: 5px;
        }
    </style>
</head>
<body>
    <h1>Meteorite Data Visualizations</h1>
    <div class="container">
        <div class="text-content">
            <h2>The Heaviest Meteorites Ever Recorded</h2>
            <p>According to National Geographic, the largest meteorite ever discovered on Earth is the Hoba meteorite, found in Namibia in 1920. 
                Weighing approximately 54,000 kilograms (119,000 pounds), the Hoba meteorite is so massive that it remains in its original location. 
                Its enormous size and weight make it impossible to move, and it has been preserved exactly where it was discovered. 
                This remarkable meteorite offers a unique opportunity to study an extraterrestrial object in its natural setting.
            </p>
        </div>
        <div id="horizontal-chart-container">
            <!-- Horizontal bar chart will be appended here -->
        </div>
    </div>
    <div class="container">
        <div class="text-content">
            <h2>Meteorite Discoveries Over Time</h2>
            <p>
                There are several factors contributing to the increase in meteorite finds over recent years. 
                Primarily, climate change and advancements in transportation technology have played significant roles. 
                The melting of Arctic ice has uncovered numerous meteorite specimens that were previously inaccessible. 
                Additionally, our rapid technological progress has enabled us to retrieve meteorites from the Moon's craters. 
                This combination of environmental and technological changes has greatly enhanced our ability to discover and study meteorites. 
            </p>
        </div>
        <div id="stacked-chart-container">
            <!-- Stacked bar chart will be appended here -->
        </div>
        <div id="legend-container">
            <!-- Legend will be appended here -->
        </div>
    </div>
    <div class="container">
        <div class="text-content">
            <h2>Meteorite Landings Around the Globe</h2>
            <p>Below is a globe showing locations where meteorites have landed. Hover over the points to see details.</p>
        </div>
        <div id="globe-container">
            <!-- Globe will be rendered here -->
            <div class="controls">
                <button onclick="rotateMap(-10, 0)">Rotate Left</button>
                <button onclick="rotateMap(10, 0)">Rotate Right</button>
                <button onclick="rotateMap(0, 10)">Rotate Down</button>
                <button onclick="rotateMap(0, -10)">Rotate Up</button>
            </div>
            <canvas id="globe-canvas"></canvas>
        </div>
    </div>
    <div class="tooltip"></div>
    <script>
        // Define dimensions for the globe
        const globeWidth = document.getElementById('globe-container').offsetWidth;
        const globeHeight = 600; // Fixed height for the globe
        const globeRadius = Math.min(globeWidth, globeHeight) / 2;

        // Set up canvas and context for the globe
        const canvas = d3.select("#globe-canvas")
            .attr("width", globeWidth)
            .attr("height", globeHeight);
        const context = canvas.node().getContext("2d");

        // Set up projection and path for the globe
        const projection = d3.geoOrthographic()
            .translate([globeWidth / 2, globeHeight / 2])
            .scale(globeRadius);
        const path = d3.geoPath().projection(projection).context(context);

        let landData, countryBorders, pinsData;
        function renderGlobe() {
            context.clearRect(0, 0, globeWidth, globeHeight);
            // Draw the map sphere
            context.beginPath();
            path({type: "Sphere"});
            context.fillStyle = "#0000ff"; // Blue for oceans
            context.fill();
            // Draw the land
            context.beginPath();
            path(landData);
            context.fillStyle = "#bada55"; // Green for land
            context.fill();
            // Draw country borders
            context.beginPath();
            path(countryBorders);
            context.strokeStyle = "#333";
            context.lineWidth = 1;
            context.stroke();
            // Draw heat map
            drawHeatMap();
        }

        function drawHeatMap() {
            // Create an off-screen canvas to compute the heat map
            const heatCanvas = document.createElement("canvas");
            heatCanvas.width = globeWidth;
            heatCanvas.height = globeHeight;
            const heatContext = heatCanvas.getContext("2d");

            // Define a color scale
            const colorScale = d3.scaleSequential(d3.interpolateWarm)
                .domain([0, 100]); // Adjust the domain as needed for your data

            // Use a simple density function for demo purposes
            const density = {};
            pinsData.forEach(d => {
                const [x, y] = projection([+d.lon, +d.lat]);
                if (x && y) {
                    const key = `${Math.floor(x)},${Math.floor(y)}`;
                    density[key] = (density[key] || 0) + 1;
                }
            });

            // Draw the heat map on the off-screen canvas
            Object.keys(density).forEach(key => {
                const [x, y] = key.split(',').map(Number);
                const value = density[key];
                heatContext.beginPath();
                heatContext.arc(x, y, 10, 0, 2 * Math.PI);
                heatContext.fillStyle = colorScale(value);
                heatContext.fill();
            });

            context.globalAlpha = 0.6; // Set the transparency for the heat map
            context.drawImage(heatCanvas, 0, 0);
            context.globalAlpha = 1; // Reset transparency
        }

        function loadGlobeData() {
            Promise.all([
                d3.json('https://skillet64.github.io/498/land-50m.json'),
                d3.json('https://skillet64.github.io/498/land-110m.json'),
                d3.csv('https://skillet64.github.io/498/Sheet 1-ml-Meteorite_Landings.csv')
            ]).then(([land, borders, pins]) => {
                landData = land;
                countryBorders = borders;
                pinsData = pins;
                renderGlobe();
            }).catch(error => console.error(error));
        }

        function rotateMap(rotateX, rotateY) {
            const [x, y] = projection.rotate();
            projection.rotate([x + rotateX, y + rotateY]);
            renderGlobe();
        }

        loadGlobeData();
    </script>
</body>
</html>
