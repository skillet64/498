<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meteorite Data Visualizations</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://d3js.org/topojson.v3.min.js"></script>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #2C3E50;
            color: #fff;
        }
        h1 {
            text-align: center;
            font-weight: bold;
            color: #fff;
            margin: 20px;
        }
        .container {
            display: flex;
            align-items: flex-start;
            padding: 20px;
            box-sizing: border-box;
        }
        .text-content {
            width: 300px;
            margin-right: 20px;
        }
        .tooltip {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.7);
            color: #fff;
            padding: 5px;
            border-radius: 3px;
            pointer-events: none;
            display: none;
        }
        svg {
            border: 1px solid #444;
        }
        .bar {
            fill: #F1C40F; /* Yellow for bars */
        }
        .bar-hover {
            fill: #fff; /* White for hover effect */
        }
        .stacked-bar {
            fill: #F1C40F; /* Default yellow for bars */
        }
        .label {
            font-size: 12px;
            fill: #fff;
        }
        .axis-label {
            font-size: 14px;
            font-weight: bold;
            fill: #fff;
        }
        .chart-svg {
            margin-bottom: 20px;
        }
        #stacked-chart-container {
            overflow-x: auto;
            white-space: nowrap;
        }
        .legend {
            font-size: 14px;
            fill: #fff;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <h1>Meteorite Data Visualizations</h1>
    <div class="container">
        <div class="text-content">
            <h2>The Heaviest Meteorites Ever Recorded</h2>
            <p>According to National Geographic, the largest meteorite ever discovered on Earth is the Hoba meteorite, found in Namibia in 1920. 
                Weighing approximately 54,000 kilograms (119,000 pounds), the Hoba meteorite is so massive that it remains in its original location. 
                Its enormous size and weight make it impossible to move, and it has been preserved exactly where it was discovered. 
                This remarkable meteorite offers a unique opportunity to study an extraterrestrial object in its natural setting.
            </p>
        </div>
        <div id="horizontal-chart-container">
            <!-- Horizontal bar chart will be appended here -->
        </div>
    </div>
    <div class="container">
        <div class="text-content">
            <h2>Meteorite Discoveries Over Time</h2>
            <p>
                There are several factors contributing to the increase in meteorite finds over recent years. 
                Primarily, climate change and advancements in transportation technology have played significant roles. 
                The melting of Arctic ice has uncovered numerous meteorite specimens that were previously inaccessible. 
                Additionally, our rapid technological progress has enabled us to retrieve meteorites from the Moon's craters. 
                This combination of environmental and technological changes has greatly enhanced our ability to discover and study meteorites. 
            </p>
        </div>
        <div id="stacked-chart-container">
            <!-- Stacked bar chart will be appended here -->
        </div>
        <div id="legend-container">
            <!-- Legend will be appended here -->
        </div>
    </div>
    <div class="container">
        <div class="text-content">
            <h2>Meteorite Landings Around the Globe</h2>
            <p>Below is a globe showing locations where meteorites have landed. Hover over the points to see details.</p>
        </div>
        <div id="globe-container">
            <!-- Globe will be appended here -->
        </div>
    </div>
    <div class="tooltip"></div>
    <script>
        // Define dimensions and margins
        const margin = { top: 20, right: 200, bottom: 100, left: 150 },
              width = 1500 - margin.left - margin.right,
              height = 600 - margin.top - margin.bottom;

        // Define color scheme
        const colorScheme = {
            bar: '#F1C40F',         // Yellow for bars
            barHover: '#fff',       // White for hover effect
            fell: '#E74C3C',        // Red for "Fell"
            found: '#3498DB',       // Blue for "Found"
            legend: '#fff'          // White for legend text
        };

        // Create SVG containers for charts
        const horizontalContainer = d3.select("#horizontal-chart-container");
        const stackedContainer = d3.select("#stacked-chart-container");
        const legendContainer = d3.select("#legend-container");

        // Create a tooltip
        const tooltip = d3.select(".tooltip");

        // Load and process data
        Promise.all([
            d3.csv('https://skillet64.github.io/498/biggest.csv'),
            d3.csv('https://skillet64.github.io/498/ml-Meteorite_Landings Pivot-ml-Meteorite_Landings Pivot.csv'),
            d3.csv('https://skillet64.github.io/498/Sheet 1-ml-Meteorite_Landings.csv'),
            d3.json('https://skillet64.github.io/498/land-110m.json'),
            d3.json('https://skillet64.github.io/498/land-50m.json')
        ]).then(([biggestData, pivotData, meteorites, land110m, land50m]) => {
            console.log('Biggest Data:', biggestData);
            console.log('Pivot Data:', pivotData);
            console.log('Meteorites:', meteorites);
            console.log('Land 110m:', land110m);
            console.log('Land 50m:', land50m);

            // Process data for horizontal bar chart
            biggestData.forEach(d => {
                d.mass = +d['mass'] || 0;  // Use the correct header for mass
            });
            biggestData.sort((a, b) => b.mass - a.mass);

            const x1 = d3.scaleLinear()
                .domain([0, d3.max(biggestData, d => d.mass)])
                .range([0, width]);

            const y1 = d3.scaleBand()
                .domain(biggestData.map(d => d.name))
                .range([0, height])
                .padding(0.1);

            const horizontalSvg = horizontalContainer.append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .attr("class", "chart-svg");

            horizontalSvg.append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`)
                .selectAll(".bar")
                .data(biggestData)
                .enter().append("rect")
                .attr("class", "bar")
                .attr("x", 0)
                .attr("y", d => y1(d.name))
                .attr("width", d => x1(d.mass))
                .attr("height", y1.bandwidth())
                .style("fill", colorScheme.bar)
                .on("mouseover", function(event, d) {
                    d3.select(this)
                        .style("fill", colorScheme.barHover);
                    tooltip
                        .style("display", "block")
                        .html(`Name: ${d.name}<br>Mass: ${d.mass} g`);
                })
                .on("mousemove", function(event) {
                    tooltip
                        .style("top", (event.pageY + 5) + "px")
                        .style("left", (event.pageX + 5) + "px");
                })
                .on("mouseout", function() {
                    d3.select(this)
                        .style("fill", colorScheme.bar);
                    tooltip.style("display", "none");
                });

            horizontalSvg.append("g")
                .attr("transform", `translate(${margin.left},${height + margin.top})`)
                .call(d3.axisBottom(x1).ticks(10, ",.0s"))
                .append("text")
                .attr("class", "axis-label")
                .attr("x", width)
                .attr("y", 40)
                .attr("text-anchor", "end")
                .attr("fill", "#fff")
                .text("Mass (g)");

            horizontalSvg.append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`)
                .call(d3.axisLeft(y1))
                .append("text")
                .attr("class", "axis-label")
                .attr("x", -40)
                .attr("y", -10)
                .attr("text-anchor", "end")
                .attr("fill", "#fff")
                .text("Meteorite Name");

            // Process data for stacked bar chart
            pivotData.forEach(d => {
                d.year = +d.year || 1399;
                d.Fell = +d.Fell || 0;
                d.Found = +d.Found || 0;
                d['Grand Total'] = d.Fell + d.Found;
            });

            const x2 = d3.scaleBand()
                .domain(pivotData.map(d => d.year))
                .range([0, width])
                .padding(0.1);

            const y2 = d3.scaleLinear()
                .domain([0, d3.max(pivotData, d => d['Grand Total'])])
                .nice()
                .range([height, 0]);

            const stackedSvg = stackedContainer.append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .attr("class", "chart-svg");

            const stack = d3.stack()
                .keys(['Fell', 'Found'])
                .order(d3.stackOrderDescending)
                .offset(d3.stackOffsetDiverging);

            const series = stack(pivotData);

            stackedSvg.append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`)
                .selectAll(".layer")
                .data(series)
                .enter().append("g")
                .attr("class", "layer")
                .attr("fill", (d, i) => colorScheme[d.key.toLowerCase()])
                .selectAll("rect")
                .data(d => d)
                .enter().append("rect")
                .attr("x", d => x2(d.data.year))
                .attr("y", d => y2(d[1]))
                .attr("height", d => y2(d[0]) - y2(d[1]))
                .attr("width", x2.bandwidth())
                .attr("class", "stacked-bar");

            stackedSvg.append("g")
                .attr("transform", `translate(${margin.left},${height + margin.top})`)
                .call(d3.axisBottom(x2))
                .append("text")
                .attr("class", "axis-label")
                .attr("x", width)
                .attr("y", 40)
                .attr("text-anchor", "end")
                .attr("fill", "#fff")
                .text("Year");

            stackedSvg.append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`)
                .call(d3.axisLeft(y2))
                .append("text")
                .attr("class", "axis-label")
                .attr("x", -40)
                .attr("y", -10)
                .attr("text-anchor", "end")
                .attr("fill", "#fff")
                .text("Count");

            // Create a legend for stacked bar chart
            legendContainer.append("div")
                .attr("class", "legend")
                .selectAll(".legend-item")
                .data([
                    { color: colorScheme.fell, text: 'Fell' },
                    { color: colorScheme.found, text: 'Found' }
                ])
                .enter().append("div")
                .attr("class", "legend-item")
                .html(d => `<div class="legend-color" style="background-color: ${d.color};"></div><div class="legend-text">${d.text}</div>`);

            // Create Globe visualization
            const globeContainer = d3.select("#globe-container");
            const globeWidth = 800;
            const globeHeight = 600;

            const projection = d3.geoOrthographic()
                .scale(globeWidth / 2)
                .translate([globeWidth / 2, globeHeight / 2])
                .clipAngle(90);

            const path = d3.geoPath().projection(projection);

            const globeSvg = globeContainer.append("svg")
                .attr("width", globeWidth)
                .attr("height", globeHeight);

            globeSvg.append("path")
                .datum(topojson.feature(land110m, land110m.objects.countries))
                .attr("class", "land")
                .attr("d", path)
                .style("fill", "#2C3E50")
                .style("stroke", "#fff")
                .style("stroke-width", "1px");

            globeSvg.selectAll("circle")
                .data(meteorites)
                .enter().append("circle")
                .attr("cx", d => projection([+d.reclong, +d.reclat])[0])
                .attr("cy", d => projection([+d.reclong, +d.reclat])[1])
                .attr("r", 3)
                .style("fill", "#F1C40F")
                .on("mouseover", function(event, d) {
                    tooltip
                        .style("display", "block")
                        .html(`Name: ${d.nametype}<br>Lat: ${+d.reclat.toFixed(2)}<br>Lon: ${+d.reclong.toFixed(2)}`);
                })
                .on("mousemove", function(event) {
                    tooltip
                        .style("top", (event.pageY + 5) + "px")
                        .style("left", (event.pageX + 5) + "px");
                })
                .on("mouseout", function() {
                    tooltip.style("display", "none");
                });

        }).catch(error => {
            console.error('Error loading data:', error);
        });
    </script>
</body>
</html>
